npm warn Unknown cli config "--watchAll". This will stop working in the next major version of npm.

> @publishing-tracker/ui-react@0.0.0 test
> jest

FAIL src/services/platformService.test.ts
  ΓùÅ platformService ΓÇ║ should fetch platforms

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/platforms"
    Received: "/api/platforms", {"params": {"search": undefined}}

    Number of calls: 1

      18 |
      19 |         expect(result).toEqual(platforms);
    > 20 |         expect(mockedAxiosClient.get).toHaveBeenCalledWith('/api/platforms');
         |                                       ^
      21 |     });
      22 |
      23 |     it('should request a new platform', async () => {

      at Object.<anonymous> (src/services/platformService.test.ts:20:39)

  ΓùÅ platformService ΓÇ║ should request a new platform

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - "/api/platforms/requests",
    + "/api/platforms",
      {"baseUrl": "new-url", "commissionRate": 0.2, "name": "New Platform"},

    Number of calls: 1

      27 |         await platformService.requestPlatform(platformRequest);
      28 |
    > 29 |         expect(mockedAxiosClient.post).toHaveBeenCalledWith('/api/platforms/requests', platformRequest);
         |                                        ^
      30 |     });
      31 | });

      at Object.<anonymous> (src/services/platformService.test.ts:29:40)

PASS src/components/ProtectedRoute.test.tsx
PASS src/pages/PlatformsPage.test.tsx
FAIL src/pages/BookListPage.test.tsx
  ΓùÅ BookListPage ΓÇ║ should render the book list page

    Unable to find role="heading" and name `/my books/i`

    Ignored nodes: comments, script, style
    <body>
      <div>
        <div
          style="animation: fadeIn 0.5s ease;"
        >
          <div
            style="margin-bottom: 3rem; display: flex; justify-content: space-between; align-items: center;"
          >
            <div>
              <h1
                style="color: rgb(30, 41, 59);"
              >
                IP Portfolio
              </h1>
              <p
                style="color: var(--text-muted); font-size: 1.1rem;"
              >
                High-level management of your intellectual property assets.
              </p>
            </div>
            <a
              class="btn-primary animate-pulse"
              data-discover="true"
              href="/books/add"
              style="padding: 0.8rem 1.75rem;"
            >
              <span
                style="font-size: 1.25rem;"
              >
                +
              </span>
               Register New Title
            </a>
          </div>
          <div
            class="card"
            style="padding: 0.75rem; margin-bottom: 2rem;"
          >
            <div
              style="position: relative; flex: 1 1 0%; display: flex; align-items: center;"
            >
              <span
                style="position: absolute; left: 1.25rem; color: rgb(148, 163, 184); font-size: 1.1rem;"
              >
                ≡ƒöì
              </span>
              <input
                placeholder="Search assets by title or author identity..."
                style="width: 100%; padding: 0.85rem 1rem 0.85rem 3.25rem; background: transparent; font-size: 1.1rem;"
                type="text"
                value=""
              />
            </div>
          </div>
          <div
            class="card"
            style="padding: 0px; overflow: hidden;"
          >
            <div
              style="display: flex; padding: 1.25rem 2rem; background-color: rgba(255, 255, 255, 0.02); border-bottom: 1px solid var(--border); font-weight: 800; color: rgb(100, 116, 139); text-transform: uppercase; font-size: 0.7rem; letter-spacing: 0.15em;"
            >
              <div
                style="flex: 2.5 1 0%;"
              >
                Asset Title & Attribution
              </div>
              <div
                style="flex: 1.5 1 0%;"
              >
                Publication Date
              </div>
              <div
                style="flex: 1 1 0%;"
              >
                Genre
              </div>
              <div
                style="flex: 1 1 0%; text-align: right;"
              >
                Management
              </div>
            </div>
            <div
              style="height: 600px; overflow: auto; position: relative;"
            >
              <div
                style="text-align: center; padding: 8rem 2rem;"
              >
                <div
                  style="font-size: 4rem; margin-bottom: 1.5rem; filter: drop-shadow(0 0 20px var(--primary-glow));"
                >
                  ≡ƒÆÄ
                </div>
                <h3>
                  Portfolio is Empty
                </h3>
                <p>
                  Begin building your legacy by registering your first title.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </body>

      18 |         );
      19 |
    > 20 |         await waitFor(() => {
         |                      ^
      21 |             expect(screen.getByRole('heading', { name: /my books/i })).toBeInTheDocument();
      22 |         });
      23 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/pages/BookListPage.test.tsx:20:22)

PASS src/pages/AddBookPage.test.tsx
FAIL src/pages/ImportPage.test.tsx
  ΓùÅ Console

    console.log
      Import result from API: {
        id: 1,
        fileName: 'test.csv',
        status: 'Completed',
        startedAt: 2024-01-01T00:00:00.000Z,
        completedAt: 2024-01-01T00:00:00.000Z,
        recordsProcessed: 15,
        recordsSuccessful: 13,
        recordsFailed: 2,
        errorLog: 'Row 5: Duplicate order ID\nRow 8: Invalid quantity'
      }

      at handleProcess (src/pages/ImportPage.tsx:75:25)

    console.log
      Records successful: 13

      at handleProcess (src/pages/ImportPage.tsx:76:25)

    console.log
      Records failed: 2

      at handleProcess (src/pages/ImportPage.tsx:77:25)

    console.log
      Records processed: 15

      at handleProcess (src/pages/ImportPage.tsx:78:25)

    console.log
      Import result from API: {
        id: 2,
        fileName: 'test.csv',
        status: 'Completed',
        startedAt: 2024-01-01T00:00:00.000Z,
        completedAt: 2024-01-01T00:00:00.000Z,
        recordsProcessed: 5,
        recordsSuccessful: 0,
        recordsFailed: 5,
        errorLog: 'All records had duplicate order IDs'
      }

      at handleProcess (src/pages/ImportPage.tsx:75:25)

    console.log
      Records successful: 0

      at handleProcess (src/pages/ImportPage.tsx:76:25)

    console.log
      Records failed: 5

      at handleProcess (src/pages/ImportPage.tsx:77:25)

    console.log
      Records processed: 5

      at handleProcess (src/pages/ImportPage.tsx:78:25)

  ΓùÅ ImportPage ΓÇ║ should render the upload step initially

    TestingLibraryElementError: Found multiple elements with the text: /Upload Sales Data/i

    Here are the matching elements:

    Ignored nodes: comments, script, style
    <p
      style="color: var(--text-main); font-size: 1.2rem; margin: 1rem 0px 2rem 0px; opacity: 0.9;"
    >
      Upload sales data from your publishing platform (KDP, IngramSpark, etc.)
    </p>

    Ignored nodes: comments, script, style
    <p
      style="margin-top: 0.5rem; font-size: 1.2rem; color: var(--text-main); opacity: 0.9; font-weight: 500;"
    >
      Upload sales data from your publishing platform
    </p>

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    <body>
      <div>
        <div
          style="max-width: 900px; margin: 0px auto;"
        >
          <h1
            style="color: rgb(30, 41, 59); background: none; -webkit-text-fill-color: initial; opacity: 1; margin-bottom: 2rem;"
          >
            Import Sales Data (v2.1)
          </h1>
          <div
            style="display: flex; margin-bottom: 2rem; padding: 1rem 0px;"
          >
            <div
              style="display: flex; align-items: center;"
            >
              <div
                style="width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; background-color: var(--primary); color: white;"
              >
                1
              </div>
              <span
                style="margin-left: 8px; margin-right: 16px; font-weight: 600; color: var(--text-main);"
              >
                Upload
              </span>
            </div>
            <div
              style="display: flex; align-items: center;"
            >
              <div
                style="width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; background-color: rgb(226, 232, 240); color: white;"
              >
                2
              </div>
              <span
                style="margin-left: 8px; margin-right: 16px; font-weight: 400; color: var(--text-muted);"
              >
                Mapping
              </span>
            </div>
            <div
              style="display: flex; align-items: center;"
            >
              <div
                style="width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; background-color: rgb(226, 232, 240); color: white;"
              >
                3
              </div>
              <span
                style="margin-left: 8px; margin-right: 16px; font-weight: 400; color: var(--text-muted);"
              >
                Summary
              </span>
            </div>
          </div>
          <div
            class="card"
            style="padding: 2.5rem;"
          >
            <div
              style="animation: fadeIn 0.3s ease;"
            >
              <h3>
                Step 1: Upload Data
              </h3>
              <p
                style="color: var(--text-main); font-size: 1.2rem; margin: 1rem 0px 2rem 0px; opacity: 0.9;"
              >
                Upload sales data from your publishing platform (KDP, IngramSpark, etc.)
              </p>
              <div
                style="border: 2px dashed var(--border); border-radius: 12px; padding: 3rem 2rem; text-align: center; background-color: rgba(255, 255, 255, 0.03); cursor: pointer; position: relative; transition: all 0.3s ease;"
              >
                <input
                  accept=".csv,.txt"
                  id="file-upload"
                  style="position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; opacity: 0; cursor: pointer; z-index: 10;"
                  type="file"
                />
                <label
                  for="file-upload"
                  style="color: var(--text-main); font-size: 1.1rem; display: flex; flex-direction: column; align-items: center; gap: 1rem;"
                >
                  <div
                    style="font-size: 3rem; margin-bottom: 0.5rem; opacity: 1; color: var(--primary);"
                  >
                    ≡ƒôé
                  </div>
                  <span
                    class="btn-primary"
                    style="display: inline-block; padding: 0.8rem 2rem; pointer-events: none; font-size: 1.1rem; margin-bottom: 0.5rem;"
                  >
                    Browse Files
                  </span>
                  <p
                    style="margin-top: 0.5rem; font-size: 1.2rem; color: var(--text-main); opacity: 0.9; font-weight: 500;"
                  >
                    Upload sales data from your publishing platform
                  </p>
                </label>
              </div>
              <div
                style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);"
              >
                <button
                  class="btn-primary"
                  disabled=""
                  style="opacity: 0.5; cursor: not-allowed;"
                >
                  Next: Map Columns
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </body>

      20 |         );
      21 |
    > 22 |         expect(screen.getByText(/Upload Sales Data/i)).toBeInTheDocument();
         |                       ^
      23 |         expect(screen.getByText(/Step 1: Upload Data/i)).toBeInTheDocument();
      24 |     });
      25 |

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/pages/ImportPage.test.tsx:22:23)

  ΓùÅ ImportPage ΓÇ║ should display summary with correct numbers after successful import

    Unable to find an element with the text: /Accuracy/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    <body>
      <div>
        <div
          style="max-width: 900px; margin: 0px auto;"
        >
          <h1
            style="color: rgb(30, 41, 59); background: none; -webkit-text-fill-color: initial; opacity: 1; margin-bottom: 2rem;"
          >
            Import Sales Data (v2.1)
          </h1>
          <div
            style="display: flex; margin-bottom: 2rem; padding: 1rem 0px;"
          >
            <div
              style="display: flex; align-items: center;"
            >
              <div
                style="width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; background-color: rgb(16, 185, 129); color: white;"
              >
                1
              </div>
              <span
                style="margin-left: 8px; margin-right: 16px; font-weight: 400; color: var(--text-muted);"
              >
                Upload
              </span>
            </div>
            <div
              style="display: flex; align-items: center;"
            >
              <div
                style="width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; background-color: rgb(16, 185, 129); color: white;"
              >
                2
              </div>
              <span
                style="margin-left: 8px; margin-right: 16px; font-weight: 400; color: var(--text-muted);"
              >
                Mapping
              </span>
            </div>
            <div
              style="display: flex; align-items: center;"
            >
              <div
                style="width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; background-color: var(--primary); color: white;"
              >
                3
              </div>
              <span
                style="margin-left: 8px; margin-right: 16px; font-weight: 600; color: var(--text-main);"
              >
                Summary
              </span>
            </div>
          </div>
          <div
            class="card"
            style="padding: 2.5rem;"
          >
            <div
              style="animation: fadeIn 0.3s ease; text-align: center;"
            >
              <div
                style="width: 60px; height: 60px; border-radius: 50%; background-color: rgb(16, 185, 129); color: white; font-size: 2rem; display: flex; align-items: center; justify-content: center; margin: 0px auto 1.5rem;"
              >
                Γ£ô
              </div>
              <h3
                style="margin-bottom: 0.5rem;"
              >
                Import Synchronized
              </h3>
              <p
                style="font-size: 1rem; color: rgb(100, 116, 139); margin-bottom: 2rem;"
              >
                Processed 
                15
                 
                records
                 from 
                <strong>
                  test.csv
                </strong>
              </p>
              <div
                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0px;"
              >
                <div
                  style="padding: 1.5rem; background-color: rgb(248, 250, 252); border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 0.5rem;"
                >
                  <span
                    style="font-size: 0.875rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;"
                  >
                    Records Successful
                  </span>
                  <span
                    class="text-success"
                    style="font-size: 1.5rem; font-weight: 700; color: rgb(30, 41, 59);"
                  >
                    13
                  </span>
                </div>
                <div
                  style="padding: 1.5rem; background-color: rgb(248, 250, 252); border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 0.5rem;"
                >
                  <span
                    style="font-size: 0.875rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;"
                  >
                    Records Failed
                  </span>
                  <span
                    class="text-danger"
                    style="font-size: 1.5rem; font-weight: 700; color: rgb(30, 41, 59);"
                  >
                    2
                  </span>
                </div>
                <div
                  style="padding: 1.5rem; background-color: rgb(248, 250, 252); border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 0.5rem;"
                >
                  <span
                    style="font-size: 0.875rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;"
                  >
                    Success Rate
                  </span>
                  <span
                    style="font-size: 1.5rem; font-weight: 700; color: rgb(30, 41, 59);"
                  >
                    87
                    %
                  </span>
                </div>
              </div>
              <div
                style="height: 8px; background-color: rgb(226, 232, 240); border-radius: 4px; margin: 2rem 0px; overflow: hidden;"
              >
                <div
                  style="height: 100%; background-color: rgb(16, 185, 129); transition: width 1s ease-out; width: 86.66666666666667%;"
                />
              </div>
              <div
                style="text-align: left; margin-top: 2.5rem; padding: 1.5rem; background-color: rgb(255, 241, 242); border-radius: 12px; border: 1px solid rgb(254, 202, 202);"
              >
                <div
                  style="font-size: 0.75rem; font-weight: 800; text-transform: uppercase; color: rgb(153, 27, 27); margin-bottom: 0.75rem; letter-spacing: 0.05em;"
                >
                  Diagnostic Audit Trail
                </div>
                <pre
                  style="white-space: pre-wrap; font-size: 0.85rem; color: rgb(153, 27, 27); margin-top: 0.5rem; max-height: 150px; overflow-y: auto;"
                >
                  Row 5: Duplicate order ID
    Row 8: Invalid quantity
                </pre>
              </div>
              <div
                style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);"
              >
                <button
                  class="btn-primary"
                >
                  Go to Sales Ledger
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </body>

      78 |
      79 |         // Check that the numbers are displayed
    > 80 |         await waitFor(() => {
         |                      ^
      81 |             // Look for the actual number values
      82 |             const successfulElements = screen.getAllByText('13');
      83 |             const failedElements = screen.getAllByText('2');

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/pages/ImportPage.test.tsx:80:22)

FAIL src/services/dashboardService.test.ts
  ΓùÅ Test suite failed to run

    src/services/dashboardService.test.ts:15:13 - error TS2353: Object literal may only specify known properties, and 'totalRevenue' does not exist in type 'DashboardSummary'.

    15             totalRevenue: 1000,
                   ~~~~~~~~~~~~

FAIL src/pages/BookPerformancePage.test.tsx
  ΓùÅ Test suite failed to run

    src/pages/BookPerformancePage.test.tsx:19:64 - error TS2345: Argument of type '{ platformName: string; totalRevenue: number; }[]' is not assignable to parameter of type 'BookPerformance[] | Promise<BookPerformance[]>'.
      Type '{ platformName: string; totalRevenue: number; }[]' is not assignable to type 'BookPerformance[]'.
        Property 'currency' is missing in type '{ platformName: string; totalRevenue: number; }' but required in type 'BookPerformance'.

    19         mockedBookService.getBookPerformance.mockResolvedValue(performanceData);
                                                                      ~~~~~~~~~~~~~~~

      src/types/book.ts:35:5
        35     currency: string;
               ~~~~~~~~
        'currency' is declared here.
    src/pages/BookPerformancePage.test.tsx:28:61 - error TS2339: Property 'toBeInTheDocument' does not exist on type 'JestMatchers<HTMLElement>'.

    28             expect(screen.getByText('Platform 1: $100.00')).toBeInTheDocument();
                                                                   ~~~~~~~~~~~~~~~~~

FAIL src/pages/DashboardPage.test.tsx
  ΓùÅ Test suite failed to run

    src/pages/DashboardPage.test.tsx:15:17 - error TS2353: Object literal may only specify known properties, and 'totalRevenue' does not exist in type 'DashboardSummary'.

    15                 totalRevenue: 1000,
                       ~~~~~~~~~~~~

      src/hooks/useDashboardData.ts:11:9
        11         summary: data?.summary,
                   ~~~~~~~~~~~~~~~~~~~~~~
        The expected type comes from property 'summary' which is declared here on type '{ summary: DashboardSummary; yoy: YoYComparison; seasonal: SeasonalPerformance[]; loading: boolean; error: string; }'
    src/pages/DashboardPage.test.tsx:24:13 - error TS2322: Type 'boolean' is not assignable to type 'string'.

    24             error: false
                   ~~~~~

      src/hooks/useDashboardData.ts:15:9
        15         error: isError ? 'Inconsistent data received from analytics engine.' : null
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        The expected type comes from property 'error' which is declared here on type '{ summary: DashboardSummary; yoy: YoYComparison; seasonal: SeasonalPerformance[]; loading: boolean; error: string; }'

FAIL src/pages/RequestPlatformPage.test.tsx
  ΓùÅ Test suite failed to run

    src/pages/RequestPlatformPage.tsx:36:51 - error TS2345: Argument of type '{ name: string; commissionRate: number; baseUrl?: string; }' is not assignable to parameter of type 'PlatformRequest'.
      Property 'baseUrl' is optional in type '{ name: string; commissionRate: number; baseUrl?: string; }' but required in type 'PlatformRequest'.

    36             await platformService.requestPlatform(data);
                                                         ~~~~

Test Suites: 7 failed, 3 passed, 10 total
Tests:       5 failed, 5 passed, 10 total
Snapshots:   0 total
Time:        6.049 s, estimated 15 s
Ran all test suites.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Github\PublishingTracker\Publishing-Tracker\apps\ui-react\publishing-tracker-ui
npm error workspace @publishing-tracker/ui-react@0.0.0
npm error location C:\Github\PublishingTracker\Publishing-Tracker\apps\ui-react\publishing-tracker-ui
npm error command failed
npm error command C:\Windows\system32\cmd.exe /d /s /c jest
